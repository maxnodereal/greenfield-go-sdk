<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>fetcher - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../../lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="../../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.19.10";</script>
<script src="../../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6060/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6060/pkg/">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6060/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package fetcher
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/ethereum/go-ethereum/eth/fetcher"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>Package fetcher contains the announcement based header, blocks or transaction synchronisation.

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="index.html#BlockFetcher">type BlockFetcher</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewBlockFetcher">func NewBlockFetcher(light bool, getHeader HeaderRetrievalFn, getBlock blockRetrievalFn, verifyHeader headerVerifierFn, broadcastBlock blockBroadcasterFn, chainHeight chainHeightFn, insertHeaders headersInsertFn, insertChain chainInsertFn, dropPeer peerDropFn) *BlockFetcher</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#BlockFetcher.Enqueue">func (f *BlockFetcher) Enqueue(peer string, block *types.Block) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#BlockFetcher.FilterBodies">func (f *BlockFetcher) FilterBodies(peer string, transactions [][]*types.Transaction, uncles [][]*types.Header, time time.Time) ([][]*types.Transaction, [][]*types.Header)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#BlockFetcher.FilterHeaders">func (f *BlockFetcher) FilterHeaders(peer string, headers []*types.Header, time time.Time) []*types.Header</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#BlockFetcher.Notify">func (f *BlockFetcher) Notify(peer string, hash common.Hash, number uint64, time time.Time, headerFetcher headerRequesterFn, bodyFetcher bodyRequesterFn) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#BlockFetcher.Start">func (f *BlockFetcher) Start()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#BlockFetcher.Stop">func (f *BlockFetcher) Stop()</a></dd>
				
			
				
				<dd><a href="index.html#HeaderRetrievalFn">type HeaderRetrievalFn</a></dd>
				
				
			
				
				<dd><a href="index.html#TxFetcher">type TxFetcher</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewTxFetcher">func NewTxFetcher(hasTx func(common.Hash) bool, addTxs func([]*types.Transaction) []error, fetchTxs func(string, []common.Hash) error) *TxFetcher</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewTxFetcherForTests">func NewTxFetcherForTests(hasTx func(common.Hash) bool, addTxs func([]*types.Transaction) []error, fetchTxs func(string, []common.Hash) error, clock mclock.Clock, rand *mrand.Rand) *TxFetcher</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TxFetcher.Drop">func (f *TxFetcher) Drop(peer string) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TxFetcher.Enqueue">func (f *TxFetcher) Enqueue(peer string, txs []*types.Transaction, direct bool) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TxFetcher.Notify">func (f *TxFetcher) Notify(peer string, hashes []common.Hash) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TxFetcher.Start">func (f *TxFetcher) Start()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TxFetcher.Stop">func (f *TxFetcher) Stop()</a></dd>
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go">block_fetcher.go</a>
			
				<a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go">tx_fetcher.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
		
			
			
			<h2 id="BlockFetcher">type <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=7111:9547#L147">BlockFetcher</a>
				<a class="permalink" href="index.html#BlockFetcher">&#xb6;</a>
				
				
			</h2>
			<p>BlockFetcher is responsible for accumulating block announcements from various peers
and scheduling them for retrieval.

			<pre>type BlockFetcher struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewBlockFetcher">func <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=9640:9914#L191">NewBlockFetcher</a>
					<a class="permalink" href="index.html#NewBlockFetcher">&#xb6;</a>
					
					
				</h3>
				<pre>func NewBlockFetcher(light <a href="../../../../../builtin/index.html#bool">bool</a>, getHeader <a href="index.html#HeaderRetrievalFn">HeaderRetrievalFn</a>, getBlock blockRetrievalFn, verifyHeader headerVerifierFn, broadcastBlock blockBroadcasterFn, chainHeight chainHeightFn, insertHeaders headersInsertFn, insertChain chainInsertFn, dropPeer peerDropFn) *<a href="index.html#BlockFetcher">BlockFetcher</a></pre>
				<p>NewBlockFetcher creates a block fetcher to retrieve blocks based on hash announcements.

				
				
			

			
				
				<h3 id="BlockFetcher.Enqueue">func (*BlockFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=11833:11902#L252">Enqueue</a>
					<a class="permalink" href="index.html#BlockFetcher.Enqueue">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#BlockFetcher">BlockFetcher</a>) Enqueue(peer <a href="../../../../../builtin/index.html#string">string</a>, block *<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Block">Block</a>) <a href="../../../../../builtin/index.html#error">error</a></pre>
				<p>Enqueue tries to fill gaps the fetcher&apos;s future import queue.

				
				
				
			
				
				<h3 id="BlockFetcher.FilterBodies">func (*BlockFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=12997:13168#L295">FilterBodies</a>
					<a class="permalink" href="index.html#BlockFetcher.FilterBodies">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#BlockFetcher">BlockFetcher</a>) FilterBodies(peer <a href="../../../../../builtin/index.html#string">string</a>, transactions [][]*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Transaction">Transaction</a>, uncles [][]*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Header">Header</a>, time <a href="../../../../../time/index.html">time</a>.<a href="../../../../../time/index.html#Time">Time</a>) ([][]*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Transaction">Transaction</a>, [][]*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Header">Header</a>)</pre>
				<p>FilterBodies extracts all the block bodies that were explicitly requested by
the fetcher, returning those that should be handled differently.

				
				
				
			
				
				<h3 id="BlockFetcher.FilterHeaders">func (*BlockFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=12204:12310#L267">FilterHeaders</a>
					<a class="permalink" href="index.html#BlockFetcher.FilterHeaders">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#BlockFetcher">BlockFetcher</a>) FilterHeaders(peer <a href="../../../../../builtin/index.html#string">string</a>, headers []*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Header">Header</a>, time <a href="../../../../../time/index.html">time</a>.<a href="../../../../../time/index.html#Time">Time</a>) []*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Header">Header</a></pre>
				<p>FilterHeaders extracts all the headers that were explicitly requested by the fetcher,
returning those that should be handled differently.

				
				
				
			
				
				<h3 id="BlockFetcher.Notify">func (*BlockFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=11339:11499#L233">Notify</a>
					<a class="permalink" href="index.html#BlockFetcher.Notify">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#BlockFetcher">BlockFetcher</a>) Notify(peer <a href="../../../../../builtin/index.html#string">string</a>, hash <a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>, number <a href="../../../../../builtin/index.html#uint64">uint64</a>, time <a href="../../../../../time/index.html">time</a>.<a href="../../../../../time/index.html#Time">Time</a>,
    headerFetcher headerRequesterFn, bodyFetcher bodyRequesterFn) <a href="../../../../../builtin/index.html#error">error</a></pre>
				<p>Notify announces the fetcher of the potential availability of a new block in
the network.

				
				
				
			
				
				<h3 id="BlockFetcher.Start">func (*BlockFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=11051:11081#L221">Start</a>
					<a class="permalink" href="index.html#BlockFetcher.Start">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#BlockFetcher">BlockFetcher</a>) Start()</pre>
				<p>Start boots up the announcement based synchroniser, accepting and processing
hash notifications and block fetches until termination requested.

				
				
				
			
				
				<h3 id="BlockFetcher.Stop">func (*BlockFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=11193:11222#L227">Stop</a>
					<a class="permalink" href="index.html#BlockFetcher.Stop">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#BlockFetcher">BlockFetcher</a>) Stop()</pre>
				<p>Stop terminates the announcement based synchroniser, canceling all pending
operations.

				
				
				
			
		
			
			
			<h2 id="HeaderRetrievalFn">type <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/block_fetcher.go?s=3546:3600#L62">HeaderRetrievalFn</a>
				<a class="permalink" href="index.html#HeaderRetrievalFn">&#xb6;</a>
				
				
			</h2>
			<p>HeaderRetrievalFn is a callback type for retrieving a header from the local chain.

			<pre>type HeaderRetrievalFn func(<a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>) *<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Header">Header</a></pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="TxFetcher">type <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=6943:8949#L135">TxFetcher</a>
				<a class="permalink" href="index.html#TxFetcher">&#xb6;</a>
				
				
			</h2>
			<p>TxFetcher is responsible for retrieving new transaction based on announcements.
<p>The fetcher operates in 3 stages:
<ul>
<li>Transactions that are newly discovered are moved into a wait list.
<li>After ~500ms passes, transactions from the wait list that have not been
broadcast to us in whole are moved into a queueing area.
<li>When a connected peer doesn&apos;t have in-flight retrieval requests, any
transaction queued up (and announced by the peer) are allocated to the
peer and moved into a fetching status until it&apos;s fulfilled or fails.
</ul>
<p>The invariants of the fetcher are:
<ul>
<li>Each tracked transaction (hash) must only be present in one of the
three stages. This ensures that the fetcher operates akin to a finite
state automata and there&apos;s do data leak.
<li>Each peer that announced transactions may be scheduled retrievals, but
only ever one concurrently. This ensures we can immediately know what is
missing from a reply and reschedule it.
</ul>

			<pre>type TxFetcher struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewTxFetcher">func <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=9053:9198#L173">NewTxFetcher</a>
					<a class="permalink" href="index.html#NewTxFetcher">&#xb6;</a>
					
					
				</h3>
				<pre>func NewTxFetcher(hasTx func(<a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>) <a href="../../../../../builtin/index.html#bool">bool</a>, addTxs func([]*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Transaction">Transaction</a>) []<a href="../../../../../builtin/index.html#error">error</a>, fetchTxs func(<a href="../../../../../builtin/index.html#string">string</a>, []<a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>) <a href="../../../../../builtin/index.html#error">error</a>) *<a href="index.html#TxFetcher">TxFetcher</a></pre>
				<p>NewTxFetcher creates a transaction fetcher to retrieve transaction
based on hash announcements.

				
				
			
				
				<h3 id="NewTxFetcherForTests">func <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=9437:9631#L179">NewTxFetcherForTests</a>
					<a class="permalink" href="index.html#NewTxFetcherForTests">&#xb6;</a>
					
					
				</h3>
				<pre>func NewTxFetcherForTests(
    hasTx func(<a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>) <a href="../../../../../builtin/index.html#bool">bool</a>, addTxs func([]*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Transaction">Transaction</a>) []<a href="../../../../../builtin/index.html#error">error</a>, fetchTxs func(<a href="../../../../../builtin/index.html#string">string</a>, []<a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>) <a href="../../../../../builtin/index.html#error">error</a>,
    clock <a href="../../common/mclock/index.html">mclock</a>.<a href="../../common/mclock/index.html#Clock">Clock</a>, rand *<a href="../../../../../math/rand/index.html">mrand</a>.<a href="../../../../../math/rand/index.html#Rand">Rand</a>) *<a href="index.html#TxFetcher">TxFetcher</a></pre>
				<p>NewTxFetcherForTests is a testing method to mock out the realtime clock with
a simulated version and the internal randomness with a deterministic one.

				
				
			

			
				
				<h3 id="TxFetcher.Drop">func (*TxFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=13830:13873#L314">Drop</a>
					<a class="permalink" href="index.html#TxFetcher.Drop">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#TxFetcher">TxFetcher</a>) Drop(peer <a href="../../../../../builtin/index.html#string">string</a>) <a href="../../../../../builtin/index.html#error">error</a></pre>
				<p>Drop should be called when a peer disconnects. It cleans up all the internal
data structures of the given node.

				
				
				
			
				
				<h3 id="TxFetcher.Enqueue">func (*TxFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=11976:12061#L254">Enqueue</a>
					<a class="permalink" href="index.html#TxFetcher.Enqueue">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#TxFetcher">TxFetcher</a>) Enqueue(peer <a href="../../../../../builtin/index.html#string">string</a>, txs []*<a href="../../core/types/index.html">types</a>.<a href="../../core/types/index.html#Transaction">Transaction</a>, direct <a href="../../../../../builtin/index.html#bool">bool</a>) <a href="../../../../../builtin/index.html#error">error</a></pre>
				<p>Enqueue imports a batch of received transaction into the transaction pool
and the fetcher. This method may be called by both transaction broadcasts and
direct request replies. The differentiation is important so the fetcher can
re-schedule missing transactions as soon as possible.

				
				
				
			
				
				<h3 id="TxFetcher.Notify">func (*TxFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=10498:10565#L206">Notify</a>
					<a class="permalink" href="index.html#TxFetcher.Notify">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#TxFetcher">TxFetcher</a>) Notify(peer <a href="../../../../../builtin/index.html#string">string</a>, hashes []<a href="../../common/index.html">common</a>.<a href="../../common/index.html#Hash">Hash</a>) <a href="../../../../../builtin/index.html#error">error</a></pre>
				<p>Notify announces the fetcher of the potential availability of a new batch of
transactions in the network.

				
				
				
			
				
				<h3 id="TxFetcher.Start">func (*TxFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=14130:14157#L325">Start</a>
					<a class="permalink" href="index.html#TxFetcher.Start">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#TxFetcher">TxFetcher</a>) Start()</pre>
				<p>Start boots up the announcement based synchroniser, accepting and processing
hash notifications and block fetches until termination requested.

				
				
				
			
				
				<h3 id="TxFetcher.Stop">func (*TxFetcher) <a href="http://localhost:6060/src/github.com/ethereum/go-ethereum/eth/fetcher/tx_fetcher.go?s=14269:14295#L331">Stop</a>
					<a class="permalink" href="index.html#TxFetcher.Stop">&#xb6;</a>
					
					
				</h3>
				<pre>func (f *<a href="index.html#TxFetcher">TxFetcher</a>) Stop()</pre>
				<p>Stop terminates the announcement based synchroniser, canceling all pending
operations.

				
				
				
			
		
	

	







<div id="footer">
Build version go1.19.10.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6060/LICENSE">BSD license</a>.<br>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
