<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>metrics - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.19.10";</script>
<script src="../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6060/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6060/pkg/">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6060/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package metrics
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/go-kit/kit/metrics"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
				<dd><a href="index.html#pkg-subdirectories">Subdirectories</a></dd>
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>Package metrics provides a framework for application instrumentation. It&apos;s
primarily designed to help you get started with good and robust
instrumentation, and to help you migrate from a less-capable system like
Graphite to a more-capable system like Prometheus. If your organization has
already standardized on an instrumentation system like Prometheus, and has no
plans to change, it may make sense to use that system&apos;s instrumentation
library directly.
<p>This package provides three core metric abstractions (Counter, Gauge, and
Histogram) and implementations for almost all common instrumentation
backends. Each metric has an observation method (Add, Set, or Observe,
respectively) used to record values, and a With method to &quot;scope&quot; the
observation by various parameters. For example, you might have a Histogram to
record request durations, parameterized by the method that&apos;s being called.
<pre>var requestDuration metrics.Histogram
// ...
requestDuration.With(&quot;method&quot;, &quot;MyMethod&quot;).Observe(time.Since(begin))
</pre>
<p>This allows a single high-level metrics object (requestDuration) to work with
many code paths somewhat dynamically. The concept of With is fully supported
in some backends like Prometheus, and not supported in other backends like
Graphite. So, With may be a no-op, depending on the concrete implementation
you choose. Please check the implementation to know for sure. For
implementations that don&apos;t provide With, it&apos;s necessary to fully parameterize
each metric in the metric name, e.g.
<pre>// Statsd
c := statsd.NewCounter(&quot;request_duration_MyMethod_200&quot;)
c.Add(1)

// Prometheus
c := prometheus.NewCounter(stdprometheus.CounterOpts{
    Name: &quot;request_duration&quot;,
    ...
}, []string{&quot;method&quot;, &quot;status_code&quot;})
c.With(&quot;method&quot;, &quot;MyMethod&quot;, &quot;status_code&quot;, strconv.Itoa(code)).Add(1)
</pre>
<h3 id="hdr-Usage">Usage</h3>
<p>Metrics are dependencies, and should be passed to the components that need
them in the same way you&apos;d construct and pass a database handle, or reference
to another component. Metrics should *not* be created in the global scope.
Instead, instantiate metrics in your func main, using whichever concrete
implementation is appropriate for your organization.
<pre>latency := prometheus.NewSummaryFrom(stdprometheus.SummaryOpts{
    Namespace: &quot;myteam&quot;,
    Subsystem: &quot;foosvc&quot;,
    Name:      &quot;request_latency_seconds&quot;,
    Help:      &quot;Incoming request latency in seconds.&quot;,
}, []string{&quot;method&quot;, &quot;status_code&quot;})
</pre>
<p>Write your components to take the metrics they will use as parameters to
their constructors. Use the interface types, not the concrete types. That is,
<pre>// NewAPI takes metrics.Histogram, not *prometheus.Summary
func NewAPI(s Store, logger log.Logger, latency metrics.Histogram) *API {
    // ...
}

func (a *API) ServeFoo(w http.ResponseWriter, r *http.Request) {
    begin := time.Now()
    // ...
    a.latency.Observe(time.Since(begin).Seconds())
}
</pre>
<p>Finally, pass the metrics as dependencies when building your object graph.
This should happen in func main, not in the global scope.
<pre>api := NewAPI(store, logger, latency)
http.ListenAndServe(&quot;/&quot;, api)
</pre>
<p>Note that metrics are &quot;write-only&quot; interfaces.
<h3 id="hdr-Implementation_details">Implementation details</h3>
<p>All metrics are safe for concurrent use. Considerable design influence has
been taken from <a href="https://github.com/codahale/metrics">https://github.com/codahale/metrics</a> and
<a href="https://prometheus.io">https://prometheus.io</a>.
<p>Each telemetry system has different semantics for label values, push vs.
pull, support for histograms, etc. These properties influence the design of
their respective packages. This table attempts to summarize the key points of
distinction.
<pre>SYSTEM      DIM  COUNTERS               GAUGES                 HISTOGRAMS
dogstatsd   n    batch, push-aggregate  batch, push-aggregate  native, batch, push-each
statsd      1    batch, push-aggregate  batch, push-aggregate  native, batch, push-each
graphite    1    batch, push-aggregate  batch, push-aggregate  synthetic, batch, push-aggregate
expvar      1    atomic                 atomic                 synthetic, batch, in-place expose
influx      n    custom                 custom                 custom
prometheus  n    native                 native                 native
pcp         1    native                 native                 native
cloudwatch  n    batch push-aggregate   batch push-aggregate   synthetic, batch, push-aggregate
</pre>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="index.html#Counter">type Counter</a></dd>
				
				
			
				
				<dd><a href="index.html#Gauge">type Gauge</a></dd>
				
				
			
				
				<dd><a href="index.html#Histogram">type Histogram</a></dd>
				
				
			
				
				<dd><a href="index.html#Timer">type Timer</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewTimer">func NewTimer(h Histogram) *Timer</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#Timer.ObserveDuration">func (t *Timer) ObserveDuration()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#Timer.Unit">func (t *Timer) Unit(u time.Duration)</a></dd>
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/doc.go">doc.go</a>
			
				<a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/metrics.go">metrics.go</a>
			
				<a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/timer.go">timer.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
		
			
			
			<h2 id="Counter">type <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/metrics.go?s=154:237#L1">Counter</a>
				<a class="permalink" href="index.html#Counter">&#xb6;</a>
				
				
			</h2>
			<p>Counter describes a metric that accumulates values monotonically.
An example of a counter is the number of received HTTP requests.

			<pre>type Counter interface {
    With(labelValues ...<a href="../../../../builtin/index.html#string">string</a>) <a href="index.html#Counter">Counter</a>
    Add(delta <a href="../../../../builtin/index.html#float64">float64</a>)
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="Gauge">type <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/metrics.go?s=367:466#L2">Gauge</a>
				<a class="permalink" href="index.html#Gauge">&#xb6;</a>
				
				
			</h2>
			<p>Gauge describes a metric that takes specific values over time.
An example of a gauge is the current depth of a job queue.

			<pre>type Gauge interface {
    With(labelValues ...<a href="../../../../builtin/index.html#string">string</a>) <a href="index.html#Gauge">Gauge</a>
    Set(value <a href="../../../../builtin/index.html#float64">float64</a>)
    Add(delta <a href="../../../../builtin/index.html#float64">float64</a>)
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="Histogram">type <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/metrics.go?s=725:816#L12">Histogram</a>
				<a class="permalink" href="index.html#Histogram">&#xb6;</a>
				
				
			</h2>
			<p>Histogram describes a metric that takes repeated observations of the same
kind of thing, and produces a statistical summary of those observations,
typically expressed as quantiles or buckets. An example of a histogram is
HTTP request latencies.

			<pre>type Histogram interface {
    With(labelValues ...<a href="../../../../builtin/index.html#string">string</a>) <a href="index.html#Histogram">Histogram</a>
    Observe(value <a href="../../../../builtin/index.html#float64">float64</a>)
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="Timer">type <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/timer.go?s=175:239#L1">Timer</a>
				<a class="permalink" href="index.html#Timer">&#xb6;</a>
				
				
			</h2>
			<p>Timer acts as a stopwatch, sending observations to a wrapped histogram.
It&apos;s a bit of helpful syntax sugar for h.Observe(time.Since(x)).

			<pre>type Timer struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewTimer">func <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/timer.go?s=309:342#L4">NewTimer</a>
					<a class="permalink" href="index.html#NewTimer">&#xb6;</a>
					
					
				</h3>
				<pre>func NewTimer(h <a href="index.html#Histogram">Histogram</a>) *<a href="index.html#Timer">Timer</a></pre>
				<p>NewTimer wraps the given histogram and records the current time.

				
				
			

			
				
				<h3 id="Timer.ObserveDuration">func (*Timer) <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/timer.go?s=544:577#L14">ObserveDuration</a>
					<a class="permalink" href="index.html#Timer.ObserveDuration">&#xb6;</a>
					
					
				</h3>
				<pre>func (t *<a href="index.html#Timer">Timer</a>) ObserveDuration()</pre>
				<p>ObserveDuration captures the number of seconds since the timer was
constructed, and forwards that observation to the histogram.

				
				
				
			
				
				<h3 id="Timer.Unit">func (*Timer) <a href="http://localhost:6060/src/github.com/go-kit/kit/metrics/timer.go?s=781:818#L24">Unit</a>
					<a class="permalink" href="index.html#Timer.Unit">&#xb6;</a>
					
					
				</h3>
				<pre>func (t *<a href="index.html#Timer">Timer</a>) Unit(u <a href="../../../../time/index.html">time</a>.<a href="../../../../time/index.html#Duration">Duration</a>)</pre>
				<p>Unit sets the unit of the float64 emitted by the timer.
By default, the timer emits seconds.

				
				
				
			
		
	

	





	
	
		<h2 id="pkg-subdirectories">Subdirectories</h2>
	
	<div class="pkg-dir">
		<table>
			<tr>
				<th class="pkg-name">Name</th>
				<th class="pkg-synopsis">Synopsis</th>
			</tr>

			
			<tr>
				<td colspan="2"><a href="../index.html">..</a></td>
			</tr>
			

			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="cloudwatch/index.html">cloudwatch</a>
					</td>
				
					<td class="pkg-synopsis">
						
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="cloudwatch2/index.html">cloudwatch2</a>
					</td>
				
					<td class="pkg-synopsis">
						Package cloudwatch2 emits all data as a StatisticsSet (rather than a singular Value) to CloudWatch via the aws-sdk-go-v2 SDK.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="discard/index.html">discard</a>
					</td>
				
					<td class="pkg-synopsis">
						Package discard provides a no-op metrics backend.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="dogstatsd/index.html">dogstatsd</a>
					</td>
				
					<td class="pkg-synopsis">
						Package dogstatsd provides a DogStatsD backend for package metrics.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="expvar/index.html">expvar</a>
					</td>
				
					<td class="pkg-synopsis">
						Package expvar provides expvar backends for metrics.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="generic/index.html">generic</a>
					</td>
				
					<td class="pkg-synopsis">
						Package generic implements generic versions of each of the metric types.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="graphite/index.html">graphite</a>
					</td>
				
					<td class="pkg-synopsis">
						Package graphite provides a Graphite backend for metrics.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="influx/index.html">influx</a>
					</td>
				
					<td class="pkg-synopsis">
						Package influx provides an InfluxDB implementation for metrics.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="influxstatsd/index.html">influxstatsd</a>
					</td>
				
					<td class="pkg-synopsis">
						Package influxstatsd provides support for InfluxData&#39;s StatsD Telegraf plugin.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="multi/index.html">multi</a>
					</td>
				
					<td class="pkg-synopsis">
						Package multi provides adapters that send observations to multiple metrics simultaneously.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="pcp/index.html">pcp</a>
					</td>
				
					<td class="pkg-synopsis">
						
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="prometheus/index.html">prometheus</a>
					</td>
				
					<td class="pkg-synopsis">
						Package prometheus provides Prometheus implementations for metrics.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="provider/index.html">provider</a>
					</td>
				
					<td class="pkg-synopsis">
						Package provider provides a factory-like abstraction for metrics backends.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="statsd/index.html">statsd</a>
					</td>
				
					<td class="pkg-synopsis">
						Package statsd provides a StatsD backend for package metrics.
					</td>
				</tr>
			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="teststat/index.html">teststat</a>
					</td>
				
					<td class="pkg-synopsis">
						Package teststat provides helpers for testing metrics backends.
					</td>
				</tr>
			
		</table>
	</div>



<div id="footer">
Build version go1.19.10.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6060/LICENSE">BSD license</a>.<br>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
