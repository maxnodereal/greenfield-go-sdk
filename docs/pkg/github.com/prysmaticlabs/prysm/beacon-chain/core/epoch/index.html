<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>epoch - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../../../lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="../../../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.19.10";</script>
<script src="../../../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6060/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6060/pkg/">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6060/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package epoch
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/prysmaticlabs/prysm/beacon-chain/core/epoch"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
				<dd><a href="index.html#pkg-subdirectories">Subdirectories</a></dd>
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>Package epoch contains epoch processing libraries according to spec, able to
process new balance for validators, justify and finalize new
check points, and shuffle validators to different slots and
shards.

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
				
				<dd><a href="index.html#AttestingBalance">func AttestingBalance(ctx context.Context, state state.ReadOnlyBeaconState, atts []*ethpb.PendingAttestation) (uint64, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessEffectiveBalanceUpdates">func ProcessEffectiveBalanceUpdates(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessEth1DataReset">func ProcessEth1DataReset(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessFinalUpdates">func ProcessFinalUpdates(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessHistoricalRootsUpdate">func ProcessHistoricalRootsUpdate(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessParticipationRecordUpdates">func ProcessParticipationRecordUpdates(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessRandaoMixesReset">func ProcessRandaoMixesReset(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessRegistryUpdates">func ProcessRegistryUpdates(ctx context.Context, state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessSlashings">func ProcessSlashings(state state.BeaconState, slashingMultiplier uint64) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#ProcessSlashingsReset">func ProcessSlashingsReset(state state.BeaconState) (state.BeaconState, error)</a></dd>
			
				
				<dd><a href="index.html#UnslashedAttestingIndices">func UnslashedAttestingIndices(ctx context.Context, state state.ReadOnlyBeaconState, atts []*ethpb.PendingAttestation) ([]types.ValidatorIndex, error)</a></dd>
			
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go">epoch_processing.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
			
			
			<h2 id="AttestingBalance">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=2535:2660#L49">AttestingBalance</a>
				<a class="permalink" href="index.html#AttestingBalance">&#xb6;</a>
				
				
			</h2>
			<pre>func AttestingBalance(ctx <a href="../../../../../../context/index.html">context</a>.<a href="../../../../../../context/index.html#Context">Context</a>, state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#ReadOnlyBeaconState">ReadOnlyBeaconState</a>, atts []*<a href="../../../proto/prysm/v1alpha1/index.html">ethpb</a>.<a href="../../../proto/prysm/v1alpha1/index.html#PendingAttestation">PendingAttestation</a>) (<a href="../../../../../../builtin/index.html#uint64">uint64</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>AttestingBalance returns the total balance from all the attesting indices.
<p>WARNING: This method allocates a new copy of the attesting validator indices set and is
considered to be very memory expensive. Avoid using this unless you really
need to get attesting balance from attestations.
<p>Spec pseudocode definition:
<pre>def get_attesting_balance(state: BeaconState, attestations: Sequence[PendingAttestation]) -&gt; Gwei:
  &quot;&quot;&quot;
  Return the combined effective balance of the set of unslashed validators participating in ``attestations``.
  Note: ``get_total_balance`` returns ``EFFECTIVE_BALANCE_INCREMENT`` Gwei minimum to avoid divisions by zero.
  &quot;&quot;&quot;
  return get_total_balance(state, get_unslashed_attesting_indices(state, attestations))
</pre>

			
			

		
			
			
			<h2 id="ProcessEffectiveBalanceUpdates">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=10503:10590#L235">ProcessEffectiveBalanceUpdates</a>
				<a class="permalink" href="index.html#ProcessEffectiveBalanceUpdates">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessEffectiveBalanceUpdates(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessEffectiveBalanceUpdates processes effective balance updates during epoch processing.
<p>Spec pseudocode definition:
<pre>def process_effective_balance_updates(state: BeaconState) -&gt; None:
  # Update effective balances with hysteresis
  for index, validator in enumerate(state.validators):
      balance = state.balances[index]
      HYSTERESIS_INCREMENT = uint64(EFFECTIVE_BALANCE_INCREMENT // HYSTERESIS_QUOTIENT)
      DOWNWARD_THRESHOLD = HYSTERESIS_INCREMENT * HYSTERESIS_DOWNWARD_MULTIPLIER
      UPWARD_THRESHOLD = HYSTERESIS_INCREMENT * HYSTERESIS_UPWARD_MULTIPLIER
      if (
          balance + DOWNWARD_THRESHOLD &lt; validator.effective_balance
          or validator.effective_balance + UPWARD_THRESHOLD &lt; balance
      ):
          validator.effective_balance = min(balance - balance % EFFECTIVE_BALANCE_INCREMENT, MAX_EFFECTIVE_BALANCE)
</pre>

			
			

		
			
			
			<h2 id="ProcessEth1DataReset">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=9230:9307#L206">ProcessEth1DataReset</a>
				<a class="permalink" href="index.html#ProcessEth1DataReset">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessEth1DataReset(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessEth1DataReset processes updates to ETH1 data votes during epoch processing.
<p>Spec pseudocode definition:
<pre>def process_eth1_data_reset(state: BeaconState) -&gt; None:
  next_epoch = Epoch(get_current_epoch(state) + 1)
  # Reset eth1 data votes
  if next_epoch % EPOCHS_PER_ETH1_VOTING_PERIOD == 0:
      state.eth1_data_votes = []
</pre>

			
			

		
			
			
			<h2 id="ProcessFinalUpdates">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=16889:16965#L405">ProcessFinalUpdates</a>
				<a class="permalink" href="index.html#ProcessFinalUpdates">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessFinalUpdates(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessFinalUpdates processes the final updates during epoch processing.

			
			

		
			
			
			<h2 id="ProcessHistoricalRootsUpdate">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=15493:15578#L367">ProcessHistoricalRootsUpdate</a>
				<a class="permalink" href="index.html#ProcessHistoricalRootsUpdate">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessHistoricalRootsUpdate(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessHistoricalRootsUpdate processes the updates to historical root accumulator during epoch processing.
<p>Spec pseudocode definition:
<pre>def process_historical_roots_update(state: BeaconState) -&gt; None:
  # Set historical root accumulator
  next_epoch = Epoch(get_current_epoch(state) + 1)
  if next_epoch % (SLOTS_PER_HISTORICAL_ROOT // SLOTS_PER_EPOCH) == 0:
      historical_batch = HistoricalBatch(block_roots=state.block_roots, state_roots=state.state_roots)
      state.historical_roots.append(hash_tree_root(historical_batch))
</pre>

			
			

		
			
			
			<h2 id="ProcessParticipationRecordUpdates">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=16625:16715#L397">ProcessParticipationRecordUpdates</a>
				<a class="permalink" href="index.html#ProcessParticipationRecordUpdates">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessParticipationRecordUpdates(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessParticipationRecordUpdates rotates current/previous epoch attestations during epoch processing.
<p>Spec pseudocode definition:
<pre>def process_participation_record_updates(state: BeaconState) -&gt; None:
  # Rotate current/previous epoch attestations
  state.previous_epoch_attestations = state.current_epoch_attestations
  state.current_epoch_attestations = []
</pre>

			
			

		
			
			
			<h2 id="ProcessRandaoMixesReset">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=14231:14311#L334">ProcessRandaoMixesReset</a>
				<a class="permalink" href="index.html#ProcessRandaoMixesReset">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessRandaoMixesReset(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessRandaoMixesReset processes the final updates to RANDAO mix during epoch processing.
<p>Spec pseudocode definition:
<pre>def process_randao_mixes_reset(state: BeaconState) -&gt; None:
  current_epoch = get_current_epoch(state)
  next_epoch = Epoch(current_epoch + 1)
  # Set randao mix
  state.randao_mixes[next_epoch % EPOCHS_PER_HISTORICAL_VECTOR] = get_randao_mix(state, current_epoch)
</pre>

			
			

		
			
			
			<h2 id="ProcessRegistryUpdates">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=4230:4330#L80">ProcessRegistryUpdates</a>
				<a class="permalink" href="index.html#ProcessRegistryUpdates">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessRegistryUpdates(ctx <a href="../../../../../../context/index.html">context</a>.<a href="../../../../../../context/index.html#Context">Context</a>, state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessRegistryUpdates rotates validators in and out of active pool.
the amount to rotate is determined churn limit.
<p>Spec pseudocode definition:
<pre>def process_registry_updates(state: BeaconState) -&gt; None:
 # Process activation eligibility and ejections
 for index, validator in enumerate(state.validators):
     if is_eligible_for_activation_queue(validator):
         validator.activation_eligibility_epoch = get_current_epoch(state) + 1

     if is_active_validator(validator, get_current_epoch(state)) and validator.effective_balance &lt;= EJECTION_BALANCE:
         initiate_validator_exit(state, ValidatorIndex(index))

 # Queue validators eligible for activation and not yet dequeued for activation
 activation_queue = sorted([
     index for index, validator in enumerate(state.validators)
     if is_eligible_for_activation(state, validator)
     # Order by the sequence of activation_eligibility_epoch setting and then index
 ], key=lambda index: (state.validators[index].activation_eligibility_epoch, index))
 # Dequeued validators for activation up to churn limit
 for index in activation_queue[:get_validator_churn_limit(state)]:
     validator = state.validators[index]
     validator.activation_epoch = compute_activation_exit_epoch(get_current_epoch(state))
</pre>

			
			

		
			
			
			<h2 id="ProcessSlashings">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=7445:7545#L159">ProcessSlashings</a>
				<a class="permalink" href="index.html#ProcessSlashings">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessSlashings(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, slashingMultiplier <a href="../../../../../../builtin/index.html#uint64">uint64</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessSlashings processes the slashed validators during epoch processing,
<pre>def process_slashings(state: BeaconState) -&gt; None:
  epoch = get_current_epoch(state)
  total_balance = get_total_active_balance(state)
  adjusted_total_slashing_balance = min(sum(state.slashings) * PROPORTIONAL_SLASHING_MULTIPLIER, total_balance)
  for index, validator in enumerate(state.validators):
      if validator.slashed and epoch + EPOCHS_PER_SLASHINGS_VECTOR // 2 == validator.withdrawable_epoch:
          increment = EFFECTIVE_BALANCE_INCREMENT  # Factored out from penalty numerator to avoid uint64 overflow
          penalty_numerator = validator.effective_balance // increment * adjusted_total_slashing_balance
          penalty = penalty_numerator // total_balance * increment
          decrease_balance(state, ValidatorIndex(index), penalty)
</pre>

			
			

		
			
			
			<h2 id="ProcessSlashingsReset">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=13129:13207#L304">ProcessSlashingsReset</a>
				<a class="permalink" href="index.html#ProcessSlashingsReset">&#xb6;</a>
				
				
			</h2>
			<pre>func ProcessSlashingsReset(state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>) (<a href="../../state/index.html">state</a>.<a href="../../state/index.html#BeaconState">BeaconState</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>ProcessSlashingsReset processes the total slashing balances updates during epoch processing.
<p>Spec pseudocode definition:
<pre>def process_slashings_reset(state: BeaconState) -&gt; None:
  next_epoch = Epoch(get_current_epoch(state) + 1)
  # Reset slashings
  state.slashings[next_epoch % EPOCHS_PER_SLASHINGS_VECTOR] = Gwei(0)
</pre>

			
			

		
			
			
			<h2 id="UnslashedAttestingIndices">func <a href="http://localhost:6060/src/github.com/prysmaticlabs/prysm/beacon-chain/core/epoch/epoch_processing.go?s=18345:18495#L457">UnslashedAttestingIndices</a>
				<a class="permalink" href="index.html#UnslashedAttestingIndices">&#xb6;</a>
				
				
			</h2>
			<pre>func UnslashedAttestingIndices(ctx <a href="../../../../../../context/index.html">context</a>.<a href="../../../../../../context/index.html#Context">Context</a>, state <a href="../../state/index.html">state</a>.<a href="../../state/index.html#ReadOnlyBeaconState">ReadOnlyBeaconState</a>, atts []*<a href="../../../proto/prysm/v1alpha1/index.html">ethpb</a>.<a href="../../../proto/prysm/v1alpha1/index.html#PendingAttestation">PendingAttestation</a>) ([]<a href="../../../../eth2-types/index.html">types</a>.<a href="../../../../eth2-types/index.html#ValidatorIndex">ValidatorIndex</a>, <a href="../../../../../../builtin/index.html#error">error</a>)</pre>
			<p>UnslashedAttestingIndices returns all the attesting indices from a list of attestations,
it sorts the indices and filters out the slashed ones.
<p>Spec pseudocode definition:
<pre>def get_unslashed_attesting_indices(state: BeaconState,
                                  attestations: Sequence[PendingAttestation]) -&gt; Set[ValidatorIndex]:
  output = set()  # type: Set[ValidatorIndex]
  for a in attestations:
      output = output.union(get_attesting_indices(state, a.data, a.aggregation_bits))
  return set(filter(lambda index: not state.validators[index].slashed, output))
</pre>

			
			

		
		
	

	





	
	
		<h2 id="pkg-subdirectories">Subdirectories</h2>
	
	<div class="pkg-dir">
		<table>
			<tr>
				<th class="pkg-name">Name</th>
				<th class="pkg-synopsis">Synopsis</th>
			</tr>

			
			<tr>
				<td colspan="2"><a href="../index.html">..</a></td>
			</tr>
			

			
				<tr>
				
					<td class="pkg-name" style="padding-left: 0px;">
						<a href="precompute/index.html">precompute</a>
					</td>
				
					<td class="pkg-synopsis">
						Package precompute provides gathering of nicely-structured data important to feed into epoch processing, such as attesting records and balances, for faster computation.
					</td>
				</tr>
			
		</table>
	</div>



<div id="footer">
Build version go1.19.10.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6060/LICENSE">BSD license</a>.<br>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
